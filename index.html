<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Room Layout Dashboard</title>
    <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; }
        #status { margin-bottom: 10px; font-weight: bold; }
        #roomLayout {
            position: relative;
            width: 400px;
            height: 400px;
            border: 2px solid #333;
            background-color: #f0f0f0;
        }
        .dot {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: red;
            border-radius: 50%;
        }
        #room-container {
            position: relative;
            width: 400px;
            height: 400px;
            margin-top: 20px;
        }
        #room-layout {
            width: 100%;
            height: auto;
            border: 2px solid #333;
        }
        #overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>

    <!-- Alert: changed Version when edited -->
    <h2>Joybien Technologies DASHBOARD V01.26</h2>
    
    <p id="status">Status: Disconnected</p>

    <!--
    <div id="roomLayout"></div>
    -->
    
    <!-- Room Bed Layout -->    

    
    <h2>Room Bed Layout</h2>
    
    <div id="room-container">
        <img id="room-layout" src="./assets/jb_room_layout_321x251.jpg" alt="Room Layout">
        <div id="overlay"></div>
    </div>

    <script>
        // (1) Connect to the MQTT broker
        console.log("(1) Connect to wss://59.124.7.95/mqtt");
        const client = mqtt.connect("wss://59.124.7.95/mqtt");

        // (2) Connection status updates
        client.on("connect", () => {
            document.getElementById("status").innerText = "Status: Connected";
            client.subscribe("bed", (err) => {
                if (!err) {
                    console.log("(2) Subscribed to topic: bed");
                } else {
                    console.error("(2) Subscription error:", err);
                }
            });
        });

        // (3) on “message” case
        // Handle incoming messages and display on layout
        client.on("message", (topic, message) => {
            if (topic == "bed") {
                console.log(message)
                const data = JSON.parse(message.toString());
                updateRoomLayout(data.loc);
            }
        });
        
        // (4) on “error” case
        client.on("error", (error) => {
            console.error("Connection Error:", error);
            document.getElementById("status").innerText = "Status: Connection Error";
        });

        // (5) on “close” case
        client.on("close", () => {
            document.getElementById("status").innerText = "Status: Disconnected";
        });

        // (6) on “update layout by x y ” case
        // Function to update the room layout with new coordinates
        function updateRoomLayout(locations) {
            const overlay = document.getElementById("overlay");
            overlay.innerHTML = ''; // Clear previous dots

            // Define real-world coordinate bounds
            const x_min = -5, x_max = 5;  // Real-world x range
            const y_min = -5, y_max = 5;  // Real-world y range

            // Get layout dimensions
            const layout_width = overlay.offsetWidth;
            const layout_height = overlay.offsetHeight;

            locations.forEach(coord => {
                const [x, y] = coord;

                // Convert real-world coordinates to pixel coordinates
                const x_px = ((x - x_min) / (x_max - x_min)) * layout_width;
                const y_px = layout_height - ((y - y_min) / (y_max - y_min)) * layout_height;

                // Create and position the dot
                const dot = document.createElement("div");
                dot.className = "dot";
                dot.style.left = `${x_px}px`;
                dot.style.top = `${y_px}px`;

                overlay.appendChild(dot);
            });
        }
    </script>

</body>
</html>




